{% extends "mimo/base.html" %}
{% comment %}
This file is part of Streampunk, a Django application for convention programmes
Copyright (C) 2012-2017 Stephen Kilbane
This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
{% endcomment %}
{% block title %}Move In Index{% endblock %}
{% block body_content %}
{% if planitems %}
  <table border="1">
  <tr>
  <th colspan="4">Plan</th>
  <th>Operations</th>
  <th colspan="6">Move In</th>
  </tr>
  <tr> <!-- Plan -->
  <th>Code</th>
  <th>Kind</th>
  <th>Subkind</th>
  <th>Count</th>
  <th></th>
  <th>Code</th> <!-- Move In -->
  <th>Kind</th>
  <th>Subkind</th>
  <th>Count</th>
  <th>Container</th>
  <th>Room</th>
  </tr>
  {% for pl in planitems %}
  {% ifchanged %}
    <tr><td colspan="11" align="center"><em>{{ pl.item.group }}</em></td></tr>
  {% endifchanged %}
    <tr>
    <!-- Plan for {{ pl.pk }} -->
{% if pl.moveinitem_set.count %}
    <td rowspan="{{ pl.moveinitem_set.count }}">{{ pl.item.code }}</td>
    <td rowspan="{{ pl.moveinitem_set.count }}">{{ pl.item.kind }}</td>
    <td rowspan="{{ pl.moveinitem_set.count }}">{{ pl.item.subkind }}</td>
    <td rowspan="{{ pl.moveinitem_set.count }}" align="right">{{ pl.item.count }}</td>
{% for mi in pl.moveinitem_set.all %}
  {% if not forloop.first %}
    <tr>
  {% endif %}
  {% if pl.moveinitem_set.count == 1 %}
    <td>
      <form action="{% url "mi_not_received" pl.pk %}" method="POST">
      {% csrf_token %}
      <input type="submit" value="Undo Mark Received" />
      </form>
    </td>
  {% else %}
    <td>
      <form action="{% url "mi_zap" mi.pk %}" method="POST">
      {% csrf_token %}
      <input type="submit" value="Zap Replacement" />
      </form>
    </td>
  {% endif %}
    <!-- Move in for {{ item.pk }} -->
    <td>{{ mi.item.code }}</a> </td>
    <td>{{ mi.item.kind }}</td>
    <td>{{ mi.item.subkind }}</td>
    <td align="right">{{ mi.item.count }}</td>
    <td>{{ mi.item.container }}</td>
    <td>{{ mi.item.room }}</td>
    </tr>
{% endfor %}
{% else %}
    <td>{{ pl.item.code }}</td>
    <td>{{ pl.item.kind }}</td>
    <td>{{ pl.item.subkind }}</td>
    <td align="right">{{ pl.item.count }}</td>
    <td>
    <form action="{% url "mi_received" pl.pk %}" method="POST">
    {% csrf_token %}
    <input type="submit" value="Mark Received" />
    </form>
    <form action="{% url "mi_replace" pl.pk %}" method="POST">
    {% csrf_token %}
    <input type="submit" value="Mark Replaced" />
    </form>
    </td>
    <td><!-- Move In code --></td>
    <td><!-- Move In kind --></td>
    <td><!-- Move In subkind --></td>
    <td><!-- Move In count --></td>
    <td><!-- Move In container --></td>
    <td><!-- Move In room --></td>
    </tr>
{% endif %}
    </tr>
  {% endfor %}
  </table>
{% else %}
  <p>No items yet.</p>
{% endif %}
{% endblock %}
